<!DOCTYPE html>
<html lang="vi">
<head>
	 <meta charset="UTF-8">
	 <title>Upload & Li·ªát k√™ file Google Drive</title>
	 <meta name="viewport" content="width=device-width, initial-scale=1">

	 	 <style>
	 	 * {
	 	 	 box-sizing: border-box;
	 	 }

	 	 body {
	 	 	 margin: 0;
	 	 	 font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
	 	 	 background: #f3f4f6;
	 	 	 color: #111827;
	 	 }

	 	 header {
	 	 	 background: linear-gradient(135deg, #2563eb, #1d4ed8);
	 	 	 color: white;
	 	 	 padding: 16px 24px;
	 	 	 box-shadow: 0 2px 8px rgba(15, 23, 42, 0.35);
	 	 }

	 	 header h1 {
	 	 	 margin: 0;
	 	 	 font-size: 20px;
	 	 }

	 	 header p {
	 	 	 margin: 4px 0 0;
	 	 	 font-size: 13px;
	 	 	 opacity: 0.9;
	 	 }

	 	 main {
	 	 	 max-width: 960px;
	 	 	 margin: 24px auto;
	 	 	 padding: 0 16px 40px;
	 	 }

	 	 .card {
	 	 	 background: #ffffff;
	 	 	 border-radius: 14px;
	 	 	 padding: 18px 20px;
	 	 	 margin-bottom: 18px;
	 	 	 box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
	 	 	 border: 1px solid #e5e7eb;
	 	 }

	 	 .card h2 {
	 	 	 margin: 0 0 8px;
	 	 	 font-size: 18px;
	 	 }

	 	 .card small {
	 	 	 display: block;
	 	 	 margin-top: 2px;
	 	 	 color: #6b7280;
	 	 	 font-size: 12px;
	 	 }

	 	 .buttons-row {
	 	 	 display: flex;
	 	 	 flex-wrap: wrap;
	 	 	 gap: 10px;
	 	 	 margin-top: 10px;
	 	 }

	 	 .btn {
	 	 	 border: none;
	 	 	 border-radius: 999px;
	 	 	 padding: 8px 16px;
	 	 	 font-size: 14px;
	 	 	 font-weight: 500;
	 	 	 cursor: pointer;
	 	 	 display: inline-flex;
	 	 	 align-items: center;
	 	 	 gap: 6px;
	 	 	 transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.08s ease, border-color 0.15s ease;
	 	 	 white-space: nowrap;
	 	 }

	 	 .btn-primary {
	 	 	 background: #2563eb;
	 	 	 color: #ffffff;
	 	 	 box-shadow: 0 4px 12px rgba(37, 99, 235, 0.35);
	 	 }

	 	 .btn-primary:hover:not(:disabled) {
	 	 	 background: #1d4ed8;
	 	 	 transform: translateY(-1px);
	 	 	 box-shadow: 0 6px 18px rgba(37, 99, 235, 0.45);
	 	 }

	 	 .btn-outline {
	 	 	 background: #ffffff;
	 	 	 color: #111827;
	 	 	 border: 1px solid #d1d5db;
	 	 }

	 	 .btn-outline:hover:not(:disabled) {
	 	 	 background: #f3f4f6;
	 	 	 border-color: #9ca3af;
	 	 }

	 	 .btn:disabled {
	 	 	 opacity: 0.55;
	 	 	 cursor: not-allowed;
	 	 	 box-shadow: none;
	 	 	 transform: none;
	 	 }

	 	 .status {
	 	 	 margin-top: 8px;
	 	 	 font-size: 13px;
	 	 	 color: #4b5563;
	 	 }

	 	 .status strong {
	 	 	 font-weight: 600;
	 	 }

	 	 .status.error {
	 	 	 color: #b91c1c;
	 	 }

	 	 .status.success {
	 	 	 color: #15803d;
	 	 }

	 	 .file-section {
	 	 	 margin-top: 8px;
	 	 	 display: flex;
	 	 	 flex-wrap: wrap;
	 	 	 align-items: center;
	 	 	 gap: 10px;
	 	 }

	 	 input[type="file"] {
	 	 	 max-width: 260px;
	 	 	 font-size: 13px;
	 	 }

	 	 table {
	 	 	 width: 100%;
	 	 	 border-collapse: collapse;
	 	 	 margin-top: 12px;
	 	 	 font-size: 13px;
	 	 }

	 	 th, td {
	 	 	 padding: 8px 10px;
	 	 	 border-bottom: 1px solid #e5e7eb;
	 	 	 text-align: left;
	 	 }

	 	 th {
	 	 	 background: #f9fafb;
	 	 	 font-weight: 600;
	 	 	 color: #4b5563;
	 	 }

	 	 tr:hover {
	 	 	 background: #f3f4f6;
	 	 }

	 	 .tag {
	 	 	 display: inline-flex;
	 	 	 align-items: center;
	 	 	 padding: 2px 8px;
	 	 	 border-radius: 999px;
	 	 	 background: #eff6ff;
	 	 	 color: #1d4ed8;
	 	 	 font-size: 11px;
	 	 	 font-weight: 500;
	 	 }

	 	 .text-muted {
	 	 	 color: #9ca3af;
	 	 	 font-size: 12px;
	 	 }

	 	 .link {
	 	 	 color: #2563eb;
	 	 	 text-decoration: none;
	 	 	 font-size: 13px;
	 	 }

	 	 .link:hover {
	 	 	 text-decoration: underline;
	 	 }

	 	 footer {
	 	 	 text-align: center;
	 	 	 font-size: 12px;
	 	 	 color: #9ca3af;
	 	 	 margin-top: 8px;
	 	 }

	 	 @media (max-width: 640px) {
	 	 	 .card {
	 	 	 	 padding: 14px 14px;
	 	 	 }

	 	 	 .file-section {
	 	 	 	 flex-direction: column;
	 	 	 	 align-items: flex-start;
	 	 	 }

	 	 	 input[type="file"] {
	 	 	 	 width: 100%;
	 	 	 }
	 	 }
	 </style>
</head>
<body>
	 <header>
	 	 <h1>Upload & Li·ªát k√™ file Google Drive</h1>
	 	 <p>HTML + CSS + JavaScript ¬∑ Ch·∫°y tr·ª±c ti·∫øp tr√™n GitHub Pages</p>
	 </header>

	 <main>
	 	 	 	 <section class="card">
	 	 	 <h2>1. ƒêƒÉng nh·∫≠p Google</h2>
	 	 	 <small>D√πng OAuth 2.0 v·ªõi Google Identity Services</small>

	 	 	 <div class="buttons-row">
	 	 	 	 <button id="authorize_button" class="btn btn-primary" disabled>
	 	 	 	 	 üîê ƒêƒÉng nh·∫≠p Google
	 	 	 	 </button>
	 	 	 	 <button id="signout_button" class="btn btn-outline" disabled>
	 	 	 	 	 üö™ ƒêƒÉng xu·∫•t
	 	 	 	 </button>
	 	 	 </div>

	 	 	 <div id="auth_status" class="status">
	 	 	 	 Tr·∫°ng th√°i: <strong>Ch∆∞a s·∫µn s√†ng</strong> (ƒëang t·∫£i th∆∞ vi·ªán Google...)
	 	 	 </div>
	 	 </section>

	 	 	 	 <section class="card">
	 	 	 <h2>2. Upload file l√™n Google Drive</h2>
	 	 	 <small>Scope: <code>https://www.googleapis.com/auth/drive</code> (To√†n quy·ªÅn)</small>

	 	 	 <div class="file-section">
	 	 	 	 	 	 	 	 <label for="file_input_files" class="btn btn-outline">
	 	 	 	 	 üìÇ Ch·ªçn File (nhi·ªÅu file)
	 	 	 	 </label>
	 	 	 	 <input type="file" id="file_input_files" multiple style="display: none;">

	 	 	 	 	 	 	 	 <label for="file_input_folder" class="btn btn-outline">
	 	 	 	 	 üìÅ Ch·ªçn Th∆∞ m·ª•c
	 	 	 	 </label>
	 	 	 	 <input type="file" id="file_input_folder" webkitdirectory style="display: none;">
	 	 	 </div>

	 	 	 <div class="buttons-row">
	 	 	 	 <button id="upload_button" class="btn btn-primary" disabled>
	 	 	 	 	 ‚¨ÜÔ∏è Upload l√™n Drive
	 	 	 	 </button>
	 	 	 </div>
	 	 	 
	 	 	 <div id="upload_status" class="status">
	 	 	 	 Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn.
	 	 	 </div>
	 	 </section>

	 	 	 	 <section class="card">
	 	 	 <h2>3. Danh s√°ch file tr√™n Google Drive</h2>
	 	 	 <small>Li·ªát k√™ 20 file g·∫ßn ƒë√¢y nh·∫•t trong "Drive c·ªßa t√¥i" (files.list)</small>

	 	 	 <div class="buttons-row">
	 	 	 	 <button id="list_button" class="btn btn-outline" disabled>
	 	 	 	 	 üîÑ T·∫£i danh s√°ch file
	 	 	 	 </button>
	 	 	 	 <span class="text-muted">* Ch·ªâ xem ƒë∆∞·ª£c file trong th∆∞ m·ª•c g·ªëc c·ªßa b·∫°n.</span>
	 	 	 </div>

	 	 	 <div id="list_status" class="status">
	 	 	 	 Ch∆∞a t·∫£i danh s√°ch file.
	 	 	 </div>

	 	 	 <table>
	 	 	 	 <thead>
	 	 	 	 	 <tr>
	 	 	 	 	 	 <th>T√™n file</th>
	 	 	 	 	 	 <th>Lo·∫°i</th>
	 	 	 	 	 	 <th>C·∫≠p nh·∫≠t</th>
	 	 	 	 	 	 <th>K√≠ch th∆∞·ªõc</th>
	 	 	 	 	 	 <th>Xem</th>
	 	 	 	 	 </tr>
	 	 	 	 </thead>
	 	 	 	 <tbody id="files_tbody">
	 	 	 	 	 	 	 	 	 </tbody>
	 	 	 </table>
	 	 </section>

	 	 <footer>
	 	 	 Code demo ¬∑ B·∫°n c·∫ßn thay <strong>CLIENT_ID</strong> v√† <strong>API_KEY</strong> trong file.
	 	 </footer>
	 </main>

	 <script>
		// TODO: THAY B·∫∞NG TH√îNG TIN TH·∫¨T C·ª¶A B·∫†N ---------------
		// D√ôNG CLIENT_ID V√Ä API_KEY M·∫™U S·∫º L√ÄM N√öT ƒêƒÇNG NH·∫¨P KH√îNG S√ÅNG!
		const CLIENT_ID = "957298442128-v4c9rc83fud515f2is92p97lojjoiuja.apps.googleusercontent.com"; // OAuth 2.0 Client ID
		const API_KEY = "AIzaSyCxJzJVa5OUlnPDKvyxiUqkIJGQ8-hxZtU"; // API key

		// Scope: S·ª≠ d·ª•ng drive ƒë·ªÉ c√≥ quy·ªÅn t·∫°o folder, upload file v√† ƒë·ªçc (drive.readonly ch·ªâ cho ph√©p ƒë·ªçc)
		const SCOPES = "https://www.googleapis.com/auth/drive";	
		const DISCOVERY_DOC = "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest";
		// -------------------------------------------------------

		let tokenClient;
		let gapiInited = false;
		let gisInited = false;
		const folderIdCache = {}; // Cache l∆∞u tr·ªØ ID c·ªßa c√°c folder ƒë√£ t·∫°o
		let filesToUpload = []; // Danh s√°ch file/folder ƒë√£ ch·ªçn

		const authorizeButton = document.getElementById("authorize_button");
		const signoutButton = document.getElementById("signout_button");
		const authStatus = document.getElementById("auth_status");

		const uploadButton = document.getElementById("upload_button");
		const uploadStatus = document.getElementById("upload_status");
		
		// C√ÅC BI·∫æN INPUT ƒê√É ƒê∆Ø·ª¢C T√ÅCH RI√äNG
		const fileInputFiles = document.getElementById("file_input_files");
		const fileInputFolder = document.getElementById("file_input_folder");

		const listButton = document.getElementById("list_button");
		const listStatus = document.getElementById("list_status");
		const filesTbody = document.getElementById("files_tbody");

		// G·ªçi khi api.js load xong
		function gapiLoaded() {
			 gapi.load("client", initializeGapiClient);
		}

		// Kh·ªüi t·∫°o client c·ªßa Google API
		async function initializeGapiClient() {
			 try {
			await gapi.client.init({
				 apiKey: API_KEY,
				 discoveryDocs: [DISCOVERY_DOC],
			});
			gapiInited = true;
			authStatus.textContent = "Th∆∞ vi·ªán Google API ƒë√£ s·∫µn s√†ng. ƒêang ch·ªù Google Identity Services...";
			maybeEnableAuthButton();
			 } catch (error) {
			console.error(error);
			authStatus.textContent = "L·ªói kh·ªüi t·∫°o Google API: " + error.message;
			authStatus.classList.add("error");
			 }
		}

		// G·ªçi khi gsi/client load xong
		function gisLoaded() {
			 tokenClient = google.accounts.oauth2.initTokenClient({
			client_id: CLIENT_ID,
			scope: SCOPES,
			callback: "", // s·∫Ω g√°n sau
			 });
			 gisInited = true;
			
			// L·∫Øng nghe s·ª± ki·ªán ch·ªçn file/folder ngay sau khi GIS load
			fileInputFiles.onchange = (e) => {
				filesToUpload = Array.from(e.target.files);
				updateUploadInputStatus();
			};

			fileInputFolder.onchange = (e) => {
				filesToUpload = Array.from(e.target.files);
				updateUploadInputStatus();
			};
			
			 maybeEnableAuthButton();
		}

		// Ch·ªâ enable n√∫t login khi c·∫£ 2 th∆∞ vi·ªán ƒë√£ s·∫µn s√†ng
		function maybeEnableAuthButton() {
			 if (gapiInited && gisInited) {
			authorizeButton.disabled = false;
			authStatus.textContent = "S·∫µn s√†ng. B·∫•m \"ƒêƒÉng nh·∫≠p Google\" ƒë·ªÉ c·∫•p quy·ªÅn.";
			 }
		}

		// C·∫≠p nh·∫≠t tr·∫°ng th√°i sau khi ch·ªçn file/folder
		function updateUploadInputStatus() {
			const count = filesToUpload.length;
			if (count > 0) {
				uploadStatus.textContent = `S·∫µn s√†ng upload ${count} m·ª•c.`;
				uploadStatus.classList.remove("error");
				uploadButton.disabled = false;
			} else {
				uploadStatus.textContent = "Ch∆∞a c√≥ t·ªáp n√†o ƒë∆∞·ª£c ch·ªçn.";
				uploadButton.disabled = true;
			}
		}

		// Khi b·∫•m ƒêƒÉng nh·∫≠p
		authorizeButton.onclick = () => {
			 authorizeButton.disabled = true;
			 authStatus.textContent = "ƒêang m·ªü popup ƒëƒÉng nh·∫≠p...";

			 tokenClient.callback = async (resp) => {
			if (resp.error !== undefined) {
				 console.error(resp);
				 authStatus.textContent = "L·ªói ƒëƒÉng nh·∫≠p: " + (resp.error || "Unknown error");
				 authStatus.classList.add("error");
				 authorizeButton.disabled = false;
				 return;
			}
			// ƒêƒÉng nh·∫≠p xong
			authStatus.textContent = "ƒê√£ ƒëƒÉng nh·∫≠p v√† c·∫•p quy·ªÅn cho Google Drive.";
			authStatus.classList.remove("error");
			authStatus.classList.add("success");

			authorizeButton.textContent = "‚úÖ ƒê√£ ƒëƒÉng nh·∫≠p";
			signoutButton.disabled = false;
			listButton.disabled = false;
			// Upload button ƒë∆∞·ª£c enable qua updateUploadInputStatus
			updateUploadInputStatus(); 
			 };

			 const token = gapi.client.getToken();
			 if (!token) {
			// THAY prompt: "consent" th√†nh "select_account" ƒë·ªÉ lu√¥n hi·ªán m√†n h√¨nh ch·ªçn t√†i kho·∫£n
			tokenClient.requestAccessToken({ prompt: "select_account" });
			 } else {
			// ƒê√£ c√≥ token ‚Üí refresh
			tokenClient.requestAccessToken({ prompt: "" });
			 }
		};

		// ƒêƒÉng xu·∫•t
		signoutButton.onclick = () => {
			 const token = gapi.client.getToken();
			 if (token !== null) {
			google.accounts.oauth2.revoke(token.access_token);
			gapi.client.setToken("");
			 }

			 authorizeButton.textContent = "üîê ƒêƒÉng nh·∫≠p Google";
			 authorizeButton.disabled = false;
			 signoutButton.disabled = true;
			 uploadButton.disabled = true;
			 listButton.disabled = true;
			filesToUpload = []; // Reset danh s√°ch file

			 authStatus.textContent = "ƒê√£ ƒëƒÉng xu·∫•t. C·∫ßn ƒëƒÉng nh·∫≠p l·∫°i ƒë·ªÉ s·ª≠ d·ª•ng.";
			 authStatus.classList.remove("success");
		};
        
        // =========================================================
        // === H√ÄM X·ª¨ L√ù UPLOAD TH∆Ø M·ª§C/NHI·ªÄU FILE ===
        // =========================================================
        
		// H√†m ki·ªÉm tra v√† t·∫°o Folder tr√™n Drive n·∫øu c·∫ßn
		async function createFolderIfNeeded(pathSegments, parentId = 'root') {
			let currentParentId = parentId;
			let currentPath = '';

			for (const segment of pathSegments) {
				currentPath = (currentPath ? currentPath + '/' : '') + segment;

				// N·∫øu ƒë√£ c√≥ trong cache, s·ª≠ d·ª•ng ID ƒë√£ l∆∞u
				if (folderIdCache[currentPath]) {
					currentParentId = folderIdCache[currentPath];
					continue;
				}

				// T√¨m ki·∫øm Folder trong th∆∞ m·ª•c cha hi·ªán t·∫°i
				// Thay th·∫ø ' b·∫±ng \' ƒë·ªÉ tr√°nh l·ªói trong chu·ªói query
				const query = `name = '${segment.replace(/'/g, "\\'")}' and mimeType = 'application/vnd.google-apps.folder' and '${currentParentId}' in parents`;
				const searchRes = await gapi.client.drive.files.list({
					q: query,
					fields: 'files(id)',
					pageSize: 1,
				});

				if (searchRes.result.files.length > 0) {
					// Folder ƒë√£ t·ªìn t·∫°i
					currentParentId = searchRes.result.files[0].id;
				} else {
					// T·∫°o Folder m·ªõi
					const folderMetadata = {
						'name': segment,
						'mimeType': 'application/vnd.google-apps.folder',
						'parents': [currentParentId],
					};

					const createRes = await gapi.client.drive.files.create({
						resource: folderMetadata,
						fields: 'id',
					});
					currentParentId = createRes.result.id;
				}

				// L∆∞u v√†o cache
				folderIdCache[currentPath] = currentParentId;
			}
			return currentParentId;
		}

		// Upload file
		uploadButton.onclick = async () => {
			uploadStatus.classList.remove("error", "success");
			const token = gapi.client.getToken();
			if (!token) {
				uploadStatus.textContent = "B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p Google tr∆∞·ªõc.";
				uploadStatus.classList.add("error");
				return;
			}

			// L·∫§Y DANH S√ÅCH FILES T·ª™ BI·∫æN GLOBAL ƒê√É ƒê∆Ø·ª¢C CH·ªåN
			const files = filesToUpload; 
			if (files.length === 0) {
				uploadStatus.textContent = "Vui l√≤ng ch·ªçn file ho·∫∑c th∆∞ m·ª•c ƒë·ªÉ upload.";
				uploadStatus.classList.add("error");
				return;
			}

			uploadButton.disabled = true;
			listButton.disabled = true;
			
			let successCount = 0;
			let errorCount = 0;
			
			uploadStatus.textContent = `ƒêang chu·∫©n b·ªã upload ${files.length} m·ª•c...`;

			try {
				// Reset cache folder cho m·ªói l·∫ßn upload m·ªõi
				Object.keys(folderIdCache).forEach(k => delete folderIdCache[k]); 

				for (let i = 0; i < files.length; i++) {
					const file = files[i];
					
					uploadStatus.textContent = `ƒêang upload ${i + 1}/${files.length}: ${file.name}...`;

					// 1. X·ª≠ l√Ω ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c cha
					let parentFolderId = 'root'; // Upload v√†o Drive c·ªßa t√¥i

					// Ch·ªâ ch·∫°y logic t·∫°o folder n·∫øu ng∆∞·ªùi d√πng ch·ªçn upload th∆∞ m·ª•c (s·∫Ω c√≥ webkitRelativePath)
					if (file.webkitRelativePath) {
						// L·∫•y c√°c th√†nh ph·∫ßn ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c (lo·∫°i b·ªè t√™n file)
						const parts = file.webkitRelativePath.split('/');
						const pathSegments = parts.slice(0, -1); 

						if (pathSegments.length > 0) {
							// T·∫°o/t√¨m ID c·ªßa th∆∞ m·ª•c cha
							parentFolderId = await createFolderIfNeeded(pathSegments, 'root');
						}
					}

					// 2. Upload file v√†o th∆∞ m·ª•c cha ƒë√£ x√°c ƒë·ªãnh/t·∫°o
					const metadata = {
						name: file.name,
						mimeType: file.type || "application/octet-stream",
						parents: [parentFolderId], // G√°n file v√†o th∆∞ m·ª•c cha
					};
					
					const form = new FormData();
					form.append(
						"metadata",
						new Blob([JSON.stringify(metadata)], { type: "application/json" })
					);
					form.append("file", file);

					const res = await fetch(
						"https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name,webViewLink,iconLink,size,mimeType",
						{
							method: "POST",
							headers: new Headers({
								Authorization: "Bearer " + token.access_token,
							}),
							body: form,
						}
					);

					if (!res.ok) {
						errorCount++;
						console.error("L·ªói upload file:", file.name, await res.text());
					} else {
						successCount++;
					}
				}
				
				// C·∫≠p nh·∫≠t tr·∫°ng th√°i cu·ªëi c√πng
				const totalUploaded = successCount + errorCount;
				if (errorCount === 0) {
					uploadStatus.textContent = `‚úÖ Upload th√†nh c√¥ng ${successCount}/${totalUploaded} m·ª•c!`;
					uploadStatus.classList.add("success");
					uploadStatus.classList.remove("error");
				} else {
					uploadStatus.textContent = `‚ö†Ô∏è Ho√†n t·∫•t: Upload th√†nh c√¥ng ${successCount}/${totalUploaded} m·ª•c, th·∫•t b·∫°i ${errorCount} m·ª•c. Ki·ªÉm tra console ƒë·ªÉ bi·∫øt chi ti·∫øt.`;
					uploadStatus.classList.add("error");
					uploadStatus.classList.remove("success");
				}

				// Reset filesToUpload v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i
				filesToUpload = []; 
				updateUploadInputStatus(); 

				await listFiles();
				
			} catch (error) {
				console.error(error);
				uploadStatus.textContent = "L·ªói upload t·ªïng qu√°t: " + error.message;
				uploadStatus.classList.add("error");
				uploadStatus.classList.remove("success");
			} finally {
				uploadButton.disabled = false;
				listButton.disabled = false;
			}
		};
        
        // =========================================================
        // === H√ÄM LI·ªÜT K√ä FILE ===
        // =========================================================

		// List files khi b·∫•m n√∫t
		listButton.onclick = () => {
			 listFiles();
		};

		// H√†m li·ªát k√™ file
		async function listFiles() {
			 listStatus.classList.remove("error", "success");
			 const token = gapi.client.getToken();
			 if (!token) {
			listStatus.textContent = "B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p Google tr∆∞·ªõc.";
			listStatus.classList.add("error");
			return;
			 }

			 listButton.disabled = true;
			 listStatus.textContent = "ƒêang t·∫£i danh s√°ch file...";

			 try {
			const response = await gapi.client.drive.files.list({
				 pageSize: 20,
				 fields: "files(id,name,mimeType,modifiedTime,iconLink,webViewLink,size)",
				 orderBy: "modifiedTime desc",
				 // L·ªçc: Ch·ªâ l·∫•y c√°c m·ª•c n·∫±m tr·ª±c ti·∫øp trong th∆∞ m·ª•c g·ªëc ('root') c·ªßa Drive c·ªßa t√¥i
				 q: "'root' in parents", 
			});

			const files = response.result.files || [];
			filesTbody.innerHTML = "";

			if (files.length === 0) {
				 listStatus.textContent = "Kh√¥ng t√¨m th·∫•y file/th∆∞ m·ª•c n√†o trong th∆∞ m·ª•c g·ªëc c·ªßa Drive c·ªßa b·∫°n.";
				 listStatus.classList.add("success");
				 return;
			}

			for (const file of files) {
				 const tr = document.createElement("tr");

				 const nameTd = document.createElement("td");
				 nameTd.textContent = file.name || "(Kh√¥ng t√™n)";

				 const isFolder = file.mimeType === 'application/vnd.google-apps.folder';

				 const typeTd = document.createElement("td");
				 const tag = document.createElement("span");
				 tag.className = "tag";
				 tag.textContent = isFolder ? "üìÅ Folder" : (file.mimeType || "Unknown");	
				 typeTd.appendChild(tag);

				 const modifiedTd = document.createElement("td");
				 modifiedTd.textContent = file.modifiedTime
				? new Date(file.modifiedTime).toLocaleString()
				: "";

				 const sizeTd = document.createElement("td");
				 sizeTd.textContent = isFolder	
				? "-" // Th∆∞ m·ª•c kh√¥ng hi·ªÉn th·ªã k√≠ch th∆∞·ªõc
				: (file.size ? formatBytes(parseInt(file.size, 10)) : "-");

				 const linkTd = document.createElement("td");
				 if (file.webViewLink) {
				const a = document.createElement("a");
				a.href = file.webViewLink;
				a.target = "_blank";
				a.rel = "noopener noreferrer";
				a.className = "link";
				a.textContent = "M·ªü";
				linkTd.appendChild(a);
				 } else {
				linkTd.textContent = "-";
				 }

				 tr.appendChild(nameTd);
				 tr.appendChild(typeTd);
				 tr.appendChild(modifiedTd);
				 tr.appendChild(sizeTd);
				 tr.appendChild(linkTd);

				 filesTbody.appendChild(tr);
			}

			listStatus.textContent = `ƒê√£ t·∫£i ${files.length} m·ª•c.`;
			listStatus.classList.add("success");
			 } catch (error) {
			console.error(error);
			listStatus.textContent = "L·ªói t·∫£i danh s√°ch file: " + error.message;
			listStatus.classList.add("error");
			 } finally {
			listButton.disabled = false;
			 }
		}

		// Helper format size
		function formatBytes(bytes) {
			 if (bytes === 0) return "0 B";
			 const k = 1024;
			 const sizes = ["B", "KB", "MB", "GB", "TB"];
			 const i = Math.floor(Math.log(bytes) / Math.log(k));
			 return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + " " + sizes[i];
		}
	</script>
	 	 <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
	 <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>